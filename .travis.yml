dist: precise
sudo: false
language: php

before_script:
- phpenv config-rm xdebug.ini || return 0
- composer install

script:
- vendor/bin/phpunit

jobs:
  include:
  - stage: Dependency Checking
    php: 7.2
  - stage: Unit Test + Code Style Fixing
    php: 5.3
  - stage: Unit Test + Code Style Fixing
    php: 5.4
  - stage: Unit Test + Code Style Fixing
    php: 5.5
  - stage: Unit Test + Code Style Fixing
    php: 7.0
  - stage: Unit Test + Code Style Fixing
    php: 7.1
  - stage: Unit Test + Code Style Fixing
    php: 7.2
  - stage: Unit Test + Code Style Fixing
    php: 5.6
    script:
    - curl -L https://github.com/fabpot/local-php-security-checker/releases/download/v1.0.0/local-php-security-checker_1.0.0_linux_amd64 -o php-dependency-checker
    - chmod +x ./php-dependency-checker
    - ./php-dependency-checker
    - rm php-dependency-checker
    - composer check
    - composer test
  - stage: deploy
    php: 5.6
    before_script: skip
    script:
    - if [[ "$TRAVIS_TAG" ]]; then ./release/build_release_package.sh ; fi
    deploy:
      provider: releases
      api_key:
        secure: "KfKbSAlpocWdsdxzUL+iLTvBclHdZHgVl6+hEmcd+EspVhKNeR97eCyujEYbON7Zt4pqo5uOzis1Kf3ovjrr1KAWr24+78l3T+3ioDgdo1J8l9CpObdL+9vxXjmMa5TGnUWyyUGA5k7MAtsCzquakWiHkH8nml8hl51+ZiEWZc1gy1yYceHPBMZI506lwy2pTK0bznkSsob4mzJkFa2jzG4DZTQcZyVo+PyeQ491NJP5E0+ksbFpZh7EZeqd3XsN02ULCurrjWawsei6loNnjkYZJYEEcng+iWw66fRw3DXUE/CxdFb0Kh1l9/TrABd2z2gKbePRyhzYVcdfUVPODnjqg6teXNCND9mg3aIfGHrXMVzHwhm0zK3cW9cVbJhwN3P4u1ZCx2cwy9nthEm6Z7lMz67nIscO85R/dmSKNcVKZEWAhvv3YmiPFHXvkoNtwqtcdAVaGbKR7gd+NXaDRKbQXp/m3pk9O/cVLabZWmqKyoPTVZXqVx18hUzJVaDOCqWrCEjG6vcwh5JPB5i6WSAgKQkk+gjqXdFz21Loe9kbcqWchZzETvQAM5ppHwFC0/jrIWqN1arIABE6czixtlqByQINsedufXEqGIkmUilY1Fxf9lwkpiZxZ6LysH5MHCpSDUq33WXTe05+BPZShywbBfxONfZIglGEQImMByc="
      file: shopgate-cart-integration-sdk.zip
      skip_cleanup: true
      on:
        tags: true

notifications:
  slack:
    rooms:
      - secure: "tjwrgY9x68hePsbMeR2HP8pJCPtrQDhhmi4yL35WHvccH79suqw8eDNCMy3ecwtE2IfzpTgqb2CjdZWvKy/YM3W/GQpjNvIOts3XOf55nmZDgplEJqHc5AWdAqxXZMG4H+KVC+40ReAYdjqpI9V0OkGxF1UnczhLBfVU85+j6F/jogkU736BM0mnteJZo0OvSH3XeO4ugykDMmpV+qlUysq+A60MBIuUWf6U5v6m97JM6vfBYclpruNtuDjMlqoz1yk0BHvvr5scDbhPML64HPfNc400Pm2jHTWQH4qVjJ4oqjGlcIPspBJenX03fhEFUBRPdRKsBxp7CklHwJpnF1i/HNW+g7iyPSpHAMhnunEichDNkP1IKTdodYOWoDM158jxOUOIGOudJCARmIdqx1hz6BODObmV7A1S8i4Uk8ilHwfs7UTPU/ajNgaoM+X7D62ChIlV7SX8pDTlNtfvRW8RKOO4H5XAf9M+RYw+QQHOUxCwfrRd10V04a9T8JQkgzX3+tBI++eAUMqtP5kJKzU+R6F2a0RTV2x4z8V7goM7jLyRYJTn0VQgZ+D+/dSpX2ZONcNG2vj7/XAodCx3kcX2RixLHXRBMvYUrUqkxQdHiX8hm7/lkUMr/Wuckc/ICu4O+o6z6OeG10Ma29NtqldYLBgd1CgA2DGaOAzb0YY="
    on_success: change
    on_failure: always
